version: '3.8'

services:
  sports-api:
    # لن نستخدم صورة من DockerHub، سنبدأ البناء من الصفر
    build:
      context: .
      dockerfile: Dockerfile
    container_name: sports-api
    restart: unless-stopped
    ports:
      - "9000:5000" # ربط المنفذ الخارجي بالداخلي
    environment:
      - ASPNETCORE_URLS=http://+:5000
      - DOTNET_ENVIRONMENT=Production
    volumes:
      - ./dataprotection-keys:/root/.aspnet/DataProtection-Keys
    labels:
      # إعدادات Coolify / Traefik التلقائية
      - "coolify.managed=true"
      - "traefik.enable=true"
      - "traefik.http.routers.sports-api.rule=Host(`backend.quattrogcc.ae`)"
      - "traefik.http.routers.sports-api.entrypoints=http,https"
      - "traefik.http.routers.sports-api.tls.certresolver=le"
      - "traefik.http.services.sports-api.loadbalancer.server.port=5000"

networks:
  default:
    name: coolify_default